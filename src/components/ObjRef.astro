---
import ObjRefIcon from './ObjRefIcon.astro';
import ObjRefText from './ObjRefText.astro';
import ObjRefHover from './ObjRefHover.astro';
import { getObjRefData } from '../utils/obj_ref';
import type { ParseObject } from '../types/parse_object';
import type { StatValueChoices } from './StatEmbedLocalizedText.astro';
import '../styles/ObjRef.css';

interface Props {
  obj: ParseObject;
  version: string;
  iconSize?: number;
  showIcon?: boolean;
  useOnHover?: boolean;
  onHoverStatChoices?: StatValueChoices;
}

const {
  obj,
  version,
  iconSize = 24,
  showIcon = true,
  useOnHover = false,
  onHoverStatChoices,
} = Astro.props;

// Get the page reference data (localization key, icon path, hex color)
const objRefData = getObjRefData(obj);

// If useHref is not specified, default to True if object has a href
const useHref = true;

const pageUrl = `/${obj.parseObjectUrl}/${obj.id}/${version}`;

if (useOnHover && !objRefData.hoverText) {
  throw new Error(
    'useOnHover is enabled but no description is available for this object.'
  );
}
---

<span class="page-ref-wrapper">
  {useHref ? (
    <a href={pageUrl}>
      {showIcon && objRefData.iconPath && (
        <ObjRefIcon objRefData={objRefData} iconSize={iconSize} />
      )}
      <ObjRefText objRefData={objRefData} />
    </a>
  ) : (
    <span>
      {showIcon && objRefData.iconPath && (
        <ObjRefIcon objRefData={objRefData} iconSize={iconSize} />
      )}
      <ObjRefText objRefData={objRefData} />
    </span>
  )}
  <ObjRefHover 
    objRefData={objRefData} 
    useOnHover={useOnHover} 
    onHoverStatChoices={onHoverStatChoices} 
  />
</span>
