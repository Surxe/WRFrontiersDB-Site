---
import Icon from './Icon.astro';
import LocalizedText from './LocalizedText.astro';
import { getPageRefData } from '../utils/page_ref';
import type { ParseObject } from '../types/parse_object';
import { getDefaultString } from '../utils/localization';

interface Props {
  obj: ParseObject;
  version: string;
  iconSize?: number;
  showIcon?: boolean;
}

const { obj, version, iconSize = 24, showIcon = true } = Astro.props;

// Get the page reference data (localization key, icon path, hex color)
const pageData = getPageRefData(obj);

// Convert parseObjectClass to URL path segment
function getPagePath(parseObjectClass: string): string {
  const pathMap: Record<string, string> = {
    Module: 'modules',
    Pilot: 'pilots',
    PilotClass: 'pilot_classes',
    PilotPersonality: 'pilot_personalities',
    PilotTalent: 'pilot_talents',
    PilotTalentType: 'pilot_talent_types',
    PilotType: 'pilot_types',
    Rarity: 'rarities',
  };
  return pathMap[parseObjectClass] || parseObjectClass.toLowerCase();
}

const pagePath = getPagePath(obj.parseObjectClass);
const pageUrl = `/WRFrontiersDB-Site/${pagePath}/${obj.id}/${version}`;
---

<a href={pageUrl}>
  <!-- Show icon if supported and enabled -->
  {
    showIcon && pageData.iconPath && (
      <Icon
        iconPath={pageData.iconPath}
        altText={`${getDefaultString(pageData.localizationKey)} icon`}
        size={iconSize}
        color={pageData.hexColor}
      />
    )
  }
  <!-- Show text with colored div if iconPath not supported, otherwise show just text-->
  {
    !pageData.iconPath && pageData.hexColor ? (
      <div
        style={`display: inline-block; padding: 2px 8px; background-color: #${pageData.hexColor}; border-radius: 4px;`}
      >
        <LocalizedText tag="span" localizationKey={pageData.localizationKey} />
      </div>
    ) : (
      <LocalizedText tag="span" localizationKey={pageData.localizationKey} />
    )
  }
</a>
