---
import type { ModuleStat } from '../../../types/module';
import LocalizedText from '../../../components/LocalizedText.astro';
import VersionList from '../../../components/VersionList.astro';
import ObjectPageScripts from '../../../components/ObjectPageScripts.astro';
import ParseObjectPage from '../../../components/ParseObjectPage.astro';
import {
  generateObjectStaticPaths,
  getParseObject,
  getVersionsData,
} from '../../../utils/parse_object';
import { getDefaultString } from '../../../utils/localization';

export async function getStaticPaths() {
  return await generateObjectStaticPaths('Objects/ModuleStat.json');
}

const { id, version } = Astro.params;
const { objectVersions } = Astro.props;

const moduleStat = getParseObject<ModuleStat>(
  id,
  version,
  'Objects/ModuleStat.json'
);

// Load version metadata
const { versions, versionInfo } = getVersionsData(version);

// Extract English text as fallback
const defaultName = getDefaultString(moduleStat.stat_name) || moduleStat.id;
---

<ParseObjectPage>
  <LocalizedText
    id="module-stat-name-title"
    tag="title"
    localizationKey={moduleStat.stat_name}
    slot="head"
  />
  <p>Back to <a href="/WRFrontiersDB-Site/module_stats">Module Stats</a></p>
  <LocalizedText
    id="module-stat-name"
    tag="h1"
    localizationKey={moduleStat.stat_name}
  />

  <div>
    <h2>Properties</h2>
    <dl>
      <dt>Short Key:</dt>
      <dd>{moduleStat.short_key}</dd>
      
      {moduleStat.unit_name && (
        <>
          <dt>Unit:</dt>
          <dd>
            <LocalizedText
              id="unit-name"
              tag="span"
              localizationKey={moduleStat.unit_name}
            />
          </dd>
        </>
      )}
      
      {moduleStat.unit_scaler !== undefined && (
        <>
          <dt>Unit Scaler:</dt>
          <dd>{moduleStat.unit_scaler}</dd>
        </>
      )}
      
      {moduleStat.unit_exponent !== undefined && (
        <>
          <dt>Unit Exponent:</dt>
          <dd>{moduleStat.unit_exponent}</dd>
        </>
      )}
      
      {moduleStat.unit_baseline !== undefined && (
        <>
          <dt>Unit Baseline:</dt>
          <dd>{moduleStat.unit_baseline}</dd>
        </>
      )}
      
      {moduleStat.decimal_places !== undefined && (
        <>
          <dt>Decimal Places:</dt>
          <dd>{moduleStat.decimal_places}</dd>
        </>
      )}
      
      {moduleStat.more_is_better !== undefined && (
        <>
          <dt>More is Better:</dt>
          <dd>{moduleStat.more_is_better ? 'Yes' : 'No'}</dd>
        </>
      )}
    </dl>
  </div>

  <p>Version: {versionInfo?.title || version} ({version})</p>
  <p>Language: <span id="current-lang">en</span></p>

  <VersionList
    parseObjectUrl="module_stats"
    id={id}
    myVersions={objectVersions}
    versionsData={versions}
  />

  <ObjectPageScripts version={version} objectData={moduleStat} />
</ParseObjectPage>
