---
import type { PilotPersonality } from '../../../types/pilot';
import Icon from '../../../components/Icon.astro';
import LocalizedText from '../../../components/LocalizedText.astro';
import VersionList from '../../../components/VersionList.astro';
import ObjectPageScripts from '../../../components/ObjectPageScripts.astro';
import ParseObjectPage from '../../../components/ParseObjectPage.astro';
import {
  generateObjectStaticPaths,
  getParseObject,
  getVersionsData,
} from '../../../utils/parse_object';
import { getDefaultString } from '../../../utils/localization';

export async function getStaticPaths() {
  return await generateObjectStaticPaths('Objects/PilotPersonality.json');
}

const { id, version } = Astro.params;
const { objectVersions } = Astro.props;

const pilotPersonality = getParseObject<PilotPersonality>(
  id,
  version,
  'Objects/PilotPersonality.json'
);

// Load version metadata
const { versions, versionInfo } = getVersionsData(version);

// Extract English text as fallback
const defaultName =
  getDefaultString(pilotPersonality.name) || pilotPersonality.id;
---

<ParseObjectPage>
  <LocalizedText
    id="pilot-personality-name-title"
    tag="title"
    localizationKey={pilotPersonality.name}
    slot="head"
  />
  <p>
    Back to <a href="/pilot_personalities">Pilot Personalities</a>
  </p>
  <LocalizedText
    id="pilot-personality-name"
    tag="h1"
    localizationKey={pilotPersonality.name}
  />

  <Icon iconPath={pilotPersonality.icon_path} altText={`${defaultName} icon`} />

  <p>Version: {versionInfo?.title || version} ({version})</p>
  <p>Language: <span id="current-lang">en</span></p>

  <VersionList
    parseObjectUrl="pilot_talent_types"
    id={id}
    myVersions={objectVersions}
    versionsData={versions}
  />

  <ObjectPageScripts version={version} objectData={pilotPersonality} />
</ParseObjectPage>
