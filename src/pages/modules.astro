---
import fs from 'fs';
import path from 'path';
import type { Module } from '../types/module';

// Load version metadata to find the latest version
const versionsPath = path.join(process.cwd(), 'WRFrontiersDB-Data/versions.json');
const versions = JSON.parse(fs.readFileSync(versionsPath, 'utf8'));

// Get the latest version (first in the object since they're sorted by date DESC)
const latestVersion = Object.keys(versions)[0];

// Load modules from latest version
let modules = {};
try {
  const modulesPath = path.join(process.cwd(), `WRFrontiersDB-Data/archive/${latestVersion}/Objects/Module.json`);
  if (fs.existsSync(modulesPath)) {
    modules = JSON.parse(fs.readFileSync(modulesPath, 'utf8'));
  }
} catch (error) {
  console.warn(`Could not load modules for latest version ${latestVersion}`);
}
---

<html>
  <head>
    <title>Modules</title>
  </head>
  <body>
    <p>Back to <a href="/WRFrontiersDB-Site/">Home</a></p>
    <h1>Modules</h1>
    
    <p>Showing modules from latest version: {versions[latestVersion].title} ({latestVersion})</p>

    <ul>
      {Object.entries(modules)
        .filter(([id, module]) => (module as Module).production_status && (module as Module).production_status !== false)
        .map(([id, module]) => (
        <li><a href={`/WRFrontiersDB-Site/modules/${id}/${latestVersion}`}>{id}</a></li>
      ))}
    </ul>
  </body>
</html>