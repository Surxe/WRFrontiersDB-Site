---
import type { PilotClass } from '../../../types/pilot';
import Icon from '../../../components/Icon.astro';
import LocalizedText from '../../../components/LocalizedText.astro';
import VersionList from '../../../components/VersionList.astro';
import ObjectPageScripts from '../../../components/ObjectPageScripts.astro';
import ParseObjectPage from '../../../components/ParseObjectPage.astro';
import {
  generateObjectStaticPaths,
  getParseObject,
  getVersionsData,
} from '../../../utils/parse_object';
import { getDefaultString } from '../../../utils/localization';

export async function getStaticPaths() {
  return await generateObjectStaticPaths('Objects/PilotClass.json');
}

const { id, version } = Astro.params;
const { objectVersions } = Astro.props;

const pilotClass = getParseObject<PilotClass>(
  id,
  version,
  'Objects/PilotClass.json'
);

// Load version metadata
const { versions, versionInfo } = getVersionsData(version);

// Extract English text as fallback
const defaultName = getDefaultString(pilotClass.name) || pilotClass.id;
---

<ParseObjectPage>
  <LocalizedText
    id="pilot-class-name-title"
    tag="title"
    localizationKey={pilotClass.name}
    slot="head"
  />
  <p>Back to <a href={`${import.meta.env.BASE_URL}pilot_classes`}>Pilot Classes</a></p>
  <LocalizedText
    id="pilot-class-name"
    tag="h1"
    localizationKey={pilotClass.name}
  />

  <Icon
    iconPath={pilotClass.badge.image_path}
    altText={`${defaultName} icon`}
    color={pilotClass.badge.hex}
  />

  <p>Version: {versionInfo?.title || version} ({version})</p>
  <p>Language: <span id="current-lang">en</span></p>

  <VersionList
    parseObjectUrl="pilot_classes"
    id={id}
    myVersions={objectVersions}
    versionsData={versions}
  />

  <ObjectPageScripts version={version} objectData={pilotClass} />
</ParseObjectPage>
